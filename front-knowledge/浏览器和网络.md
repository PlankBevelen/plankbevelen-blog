# 浏览器和网络

## 浏览器渲染机制

### 浏览器渲染流程

1. 解析HTML构建DOM树：

- 浏览器将HTML字节流转换为字符，再通过词法分析生成Tokens（标记）
- 通过语法分析将Tokens构建成嵌套的DOM节点树
- 关键点：解析是增量进行的（无需等待整个HTML下载完）

2. 解析CSS构建CSSOM树：

- 遇到\<link\>或\<style\>时启动CSS解析
- 解析规则与DOM类似：CSS字节 → 字符 → Tokens → CSSOM树
- 关键点：CSS解析与DOM解析并行，但会阻塞渲染

3. JavaScript的处理：

- 当解析遇到\<script\>标签时：
    - 默认行为：立即停止HTML解析（DOM构建暂停）
    - 先执行完JS（包括下载+执行），再恢复HTML解析
- 例外情况：
    - async脚本：异步下载，下载完成后立即执行（可能中断渲染）
    - defer脚本：异步下载，延迟到DOM解析完成后执行

4. 构建渲染树（Render Tree）：

- 合并DOM树和CSSOM树，生成包含可见元素的渲染树
- 排除不可见元素（如display:none、<head>）

5. 布局（Layout/Reflow）：

- 计算渲染树中每个节点的精确位置和尺寸（视口大小相关）
- 输出元素的盒模型信息（坐标、宽高等

6. 绘制（Painting）：

- 将布局结果转换为屏幕上的像素
- 分为多个层（Layers）进行绘制
- 包括文本、颜色、边框等视觉效果的绘制

7. 合成（Compositing）：

- 将不同的绘制层合并为最终屏幕图像
- 通过GPU加速处理（尤其对动画/变换优化）


### 重排(Reflow)和重绘(Repaint)

重排：元素几何属性改变，需要重新计算布局

触发条件：修改width、height、margin、padding、display等
影响范围：可能影响整个页面布局

重绘：元素样式改变但不影响布局

触发条件：修改color、background、visibility等
影响范围：仅重绘该元素

优化策略：

- 批量操作DOM
- 使用transform和opacity做动画
- 避免频繁读取offsetWidth等属性

## HTTP 协议

这一块主要介绍HTTP协议的一些基础知识，包括请求方法、状态码、请求头、响应头、缓存机制等。
以及HTTP协议的版本、长连接、短连接、管道机制、Cookie、跨域请求等。
最重要的是介绍http的各个版本之间的区别，以及它们的优缺点。

### http请求方法

HTTP协议定义了七种请求方法，常用的有：

- GET：获取资源
- POST：提交数据，如表单数据
- PUT：上传文件
- DELETE：删除资源
- HEAD：获取资源的元数据
- OPTIONS：获取资源支持的请求方法
- TRACE：追踪路径

### http状态码

HTTP协议定义了五种状态码，常用的有：

- 2xx：成功
- 3xx：重定向
- 4xx：客户端错误
- 5xx：服务器错误

常用状态码：

- 200 OK：请求成功
- 301 Moved Permanently：永久重定向
- 302 Found：临时重定向
- 400 Bad Request：请求语法错误
- 401 Unauthorized：请求未授权
- 403 Forbidden：禁止访问
- 404 Not Found：未找到资源
- 500 Internal Server Error：服务器内部错误

特殊的状态码：

- 204 No Content：请求成功，但没有内容
- 303 See Other：临时重定向，且总是使用GET请求
- 304 Not Modified：资源未修改
- 405 Method Not Allowed：请求方法不被允许
- 406 Not Acceptable：无法满足客户端请求的Accept头
- 408 Request Timeout：请求超时
- 411 Length Required：需要Content-Length头
- 413 Payload Too Large：请求实体太大
- 414 URI Too Long：请求URI太长
- 502 Bad Gateway：网关错误
- 503 Service Unavailable：服务器暂时无法处理请求
- 504 Gateway Timeout：网关超时
- 505 HTTP Version Not Supported：HTTP版本不支持

## 缓存机制

### 强缓存

浏览器会直接使用本地缓存，不发送请求到服务器，速度最快

HTTP 响应头控制：

- Cache-Control（优先级更高）
    - max-age=3600：缓存有效期（秒）
    - no-cache：禁用强缓存（走协商缓存）
    - no-store：完全禁用缓存 
    - public：允许代理服务器缓存
    - private：仅允许浏览器缓存

### 协商缓存

浏览器携带校验信息向服务器询问，若资源未修改则返回 304（Not Modified），否则返回新资源。

HTTP 头字段：
- Expires（HTTP/1.0 遗留字段, 优先级低）
    - 指定过期时间（如 Expires: Wed, 21 Oct 2025 07:28:00 GMT）
    - 问题：依赖客户端时间，可能不准确
    - 字段：Last-Modified、If-Modified-Since

## 跨域问题

### 同源策略

同源策略是浏览器的安全策略，限制了不同源的文档或脚本如何进行交互。

同源指的是两个页面具有相同协议、域名、端口号。

### 解决方案

1. CORS：服务端设置Access-Control-Allow-Origin响应头，允许跨域请求。
2. JSONP：利用script标签不受同源策略限制，通过回调函数返回数据。这个方法是向服务器请求的时候，在 url 后面写上 callback 方法的名字，请求返回实际上是返回了一个 调用 callback 方法的 js 文件。需要返回的参数也就在调用的时候传进去了。
所以局限也很明确，只支持 get 方法。
3. 代理服务器：所有的请求先发送给这个代理服务器，由这个代理服务器去请求实际的接口，再把需要的数据返回。
4. PostMessage：用于iframe通信
5. WebSocket：不受同源策略限制，可实现跨域通信。

## 网络安全

### XSS (跨站脚本攻击)

- 反射型XSS：URL参数中的恶意脚本
- 存储型XSS：存储在服务器的恶意脚本
- DOM型XSS：纯前端漏洞

防护：

- 输入验证和输出编码
- CSP(Content Security Policy)
- HttpOnly Cookie

### CSRF (跨站请求伪造)

- 利用用户已认证的会话执行恶意操作

防护：

- CSRF Token
- SameSite Cookie
- 验证Referer头

### CSP(内容安全策略)

这个是强制要求使用HTTPS的一种安全机制，通过设置Content-Security-Policy响应头来限制资源加载的位置。

vue 项目 npm run build 生成的 index.html 文件中可以看到 CSP 相关的设置。

## 浏览器存储

### Cookie

Cookie 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在同一浏览器上所有同域请求中携带，用于标识用户身份、跟踪用户行为。

Cookie 主要用于以下场景：

- 会话状态管理（如登录状态、购物车）
- 个性化设置（如主题、语言）

Cookie 存储大小：4kb

Cookie 有效期：如果没设置，默认为会话级别（关闭浏览器即失效），可以设置过期时间。

Cookie 安全性：自动通过 https 传输，不建议在 Cookie 中存储敏感信息。

### localStorage 和 sessionStorage

localStorage 和 sessionStorage 都是 HTML5 规范中提供的本地存储机制，可以将数据保存在用户浏览器中，除非主动删除，否则数据在浏览器关闭后依然存在。并且sessionStorage 只能在当前窗口使用，localStorage 在所有同源窗口中都可以访问。

localStorage 存储大小：5MB-10MB

sessionStorage 存储大小：5MB-10MB

### IndexedDB

IndexedDB 是一个基于浏览器的 NoSQL 数据库，它提供索引功能，可以快速查询数据。

IndexedDB 存储大小：无限制

IndexedDB 安全性：同源策略限制，需要 HTTPS。













